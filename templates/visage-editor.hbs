<div class="visage-editor-container workstation-layout">
    
    {{!-- 1. GLOBAL HEADER (Identity) --}}
    <header class="visage-editor-header">
        
        {{!-- Label Group --}}
        <div class="header-form-group label-group">
            <label>{{localize "VISAGE.GlobalEditor.Label"}}</label>
            <input type="text" name="label" value="{{label}}" placeholder="{{localize 'VISAGE.GlobalEditor.DefaultLabel'}}" required>
        </div>

        {{!-- NEW: Mode Group --}}
        <div class="header-form-group mode-group">
            <label>{{localize "VISAGE.GlobalEditor.Mode"}}</label>
            <div class="visage-mode-toggle">
                {{!-- Identity Option --}}
                <input type="radio" name="mode" id="mode-identity-{{appId}}" value="identity" {{checked (visageEq mode "identity")}}>
                <label for="mode-identity-{{appId}}" data-tooltip="VISAGE.Mode.IdentityHint">
                    <i class="visage-icon visage"></i> {{localize "VISAGE.Mode.Identity"}}
                </label>

                {{!-- Overlay Option --}}
                <input type="radio" name="mode" id="mode-overlay-{{appId}}" value="overlay" {{checked (visageEq mode "overlay")}}>
                <label for="mode-overlay-{{appId}}" data-tooltip="VISAGE.Mode.OverlayHint">
                    <i class="visage-icon domino"></i> {{localize "VISAGE.Mode.Overlay"}}
                </label>
            </div>
        </div>
        
        {{!-- Category Group --}}
        <div class="header-form-group category-group">
            <label>{{localize "VISAGE.GlobalEditor.Category"}}</label>
            <input type="text" name="category" value="{{category}}" list="visage-categories" placeholder="{{localize 'VISAGE.GlobalEditor.CategoryPlaceholder'}}">
            <datalist id="visage-categories">
                {{#each categories}}
                <option value="{{this}}"></option>
                {{/each}}
            </datalist>
        </div>

        {{!-- Tags Group --}}
        <div class="header-form-group tags-group">
            <label>{{localize "VISAGE.GlobalEditor.Tags"}}</label>
            <div class="visage-tag-container compact">
                <div class="visage-tag-pills">
                    {{!-- Pills injected by JS --}}
                </div>
                <input type="text" class="visage-tag-input" list="visage-all-tags" placeholder="{{localize 'VISAGE.GlobalEditor.TagsHint'}}">
                <input type="hidden" name="tags" value="{{tags}}">
            </div>
            <datalist id="visage-all-tags">
                {{#each allTags}}
                <option value="{{this}}"></option>
                {{/each}}
            </datalist>
        </div>

    </header>

    <div class="visage-workstation">
        
        {{!-- 2. LEFT PANEL: STAGE & STATS --}}
        <div class="visage-stage-panel">
            
            {{!-- A. THE STAGE (Flex Grow) --}}
            <div class="visage-live-preview-stage">
                {{!-- Reusing the Preview Partial directly --}}
                {{> "modules/visage/templates/parts/visage-preview.hbs" 
                    resolvedPath=preview.img 
                    name=preview.name
                    hasCheckerboard=true
                    alpha=preview.alpha
                    isVideo=preview.isVideo                                    
                    hasRing=preview.hasRing 
                    hasInvisibility=preview.hasInvisibility
                    hasPulse=preview.hasPulse
                    hasGradient=preview.hasGradient
                    hasWave=preview.hasWave
                    ringColor=preview.ringColor
                    ringBkg=preview.ringBkg                                    
                    forceFlipX=preview.flipX
                    forceFlipY=preview.flipY
                    wrapperClass="visage-preview-content stage-mode"
                }}
                
                {{!-- Token Name Overlay --}}
                <div class="stage-overlay-name">{{preview.name}}</div>

                {{!-- Hint Text --}}
                <div class="visage-stage-hint">{{localize "VISAGE.Editor.StageHint"}}</div>

                {{!-- Zoom Controls HUD --}}
                <div class="visage-zoom-controls">
                    {{!-- Grid Toggle --}}
                    <button type="button" data-action="toggleGrid" data-tooltip="{{localize 'VISAGE.Editor.ToggleGrid'}}">
                        <i class="visage-icon grid-on"></i>
                    </button>
                    
                    <div class="visage-divider-vertical" style="width:1px; background:rgba(255,255,255,0.1); margin: 0 4px;"></div>

                    <button type="button" data-action="zoomOut" data-tooltip="{{localize 'VISAGE.Editor.ZoomOut'}}">
                        <i class="visage-icon zoom-out"></i>
                    </button>
                    <button type="button" data-action="resetZoom" data-tooltip="{{localize 'VISAGE.Editor.ResetView'}}">
                        <i class="visage-icon center-focus"></i>
                    </button>
                    <button type="button" data-action="zoomIn" data-tooltip="{{localize 'VISAGE.Editor.ZoomIn'}}">
                        <i class="visage-icon zoom-in"></i>
                    </button>
                </div>
            </div>

            {{!-- B. METADATA GRID (Compact Footer) --}}
            <div class="metadata-grid">
                
                {{!-- Row 1: Scale --}}
                <div class="meta-item {{#unless preview.slots.scale.active}}inactive{{/unless}}">
                    <i class="visage-icon scale"></i>
                    <span class="meta-label">{{localize 'VISAGE.Directory.Tooltip.Scale'}}:</span>
                    <span class="meta-value">{{preview.slots.scale.val}}</span>
                </div>

                {{!-- Row 1: Dimensions --}}
                <div class="meta-item {{#unless preview.slots.dim.active}}inactive{{/unless}}">
                    <i class="visage-icon dimensions"></i>
                    <span class="meta-label">{{localize 'VISAGE.Config.List.Width'}}/{{localize 'VISAGE.Config.List.Height'}}:</span>
                    <span class="meta-value">{{preview.slots.dim.val}}</span>
                </div>
                
                {{!-- Row 2: Rotation Lock --}}
                <div class="meta-item {{#unless preview.slots.lock.active}}inactive{{/unless}}">
                    <i class="visage-icon lock"></i>
                    <span class="meta-label">{{localize 'VISAGE.RotationLock.Label'}}:</span>
                    <span class="meta-value">{{preview.slots.lock.val}}</span>
                </div>

                {{!-- Row 2: Wildcard --}}
                <div class="meta-item {{#unless preview.slots.wildcard.active}}inactive{{/unless}}">
                    <i class="visage-icon wildcard"></i>
                    <span class="meta-label">{{localize 'VISAGE.Wildcard.Label'}}:</span>
                    <span class="meta-value">{{preview.slots.wildcard.val}}</span>
                </div>

                {{!-- Row 3: Disposition --}}
                <div class="meta-item disposition-item">
                     <i class="visage-icon visage"></i>
                     <span class="meta-label">{{localize "VISAGE.Disposition.Label"}}:</span>
                     <span class="visage-disposition-text {{preview.slots.disposition.class}}">{{preview.slots.disposition.val}}</span>
                </div>

                {{!-- Row 3: Mirroring (Split H/V) --}}
                <div class="meta-item mirror-split">
                    
                    {{!-- Horizontal --}}
                    <div class="mirror-sub-slot horizontal {{#unless preview.slots.flipH.active}}inactive{{/unless}}" 
                         title="{{localize 'VISAGE.Mirror.Horizontal.Label'}}">
                        <img src="{{preview.slots.flipH.src}}" class="visage-icon-nav {{preview.slots.flipH.cls}}"/>
                        <span class="meta-value">{{localize "VISAGE.Mirror.Badge.H"}}</span>
                    </div>

                    {{!-- Vertical --}}
                    <div class="mirror-sub-slot vertical {{#unless preview.slots.flipV.active}}inactive{{/unless}}" 
                         title="{{localize 'VISAGE.Mirror.Vertical.Label'}}">
                        <img src="{{preview.slots.flipV.src}}" class="visage-icon-nav {{preview.slots.flipV.cls}}"/>
                        <span class="meta-value">{{localize "VISAGE.Mirror.Badge.V"}}</span>
                    </div>

                </div>
            </div>

        </div>

        {{!-- 3. RIGHT PANEL: INSPECTOR --}}
        <div class="visage-inspector-panel">
            
            {{!-- TABS NAVIGATION --}}
            <nav class="visage-tabs tabs" aria-label="{{localize 'VISAGE.NavLabel'}}">
                <a class="item active" data-tab="appearance">{{localize "VISAGE.Editor.Tabs.Appearance"}}</a>
                <a class="item" data-tab="ring">{{localize "VISAGE.Editor.Tabs.Ring"}}</a>
                
                {{!-- Effects Tab with Warning if Disabled --}}
                <a class="item" data-tab="effects">
                    {{localize "VISAGE.Editor.Tabs.Effects"}}
                    {{#unless hasSequencer}}
                    <i class="fas fa-exclamation-triangle" style="font-size: 0.7em; color: var(--filroden-color-warning); margin-left: 4px;" title="{{localize 'VISAGE.Editor.Effects.DependencyTitle'}}"></i>
                    {{/unless}}
                </a>
            </nav>

            {{!-- TAB CONTENT CONTAINER --}}
            <section class="visage-tab-content">
                
                {{!-- TAB 1: APPEARANCE --}}
                <div class="tab active" data-tab="appearance" data-group="primary">
                    <fieldset class="visage-fieldset inspector-fieldset">
                        
                        {{!-- Name Override --}}
                        <div class="form-group checkbox-input-group">
                            <input class="visage-checkbox" type="checkbox" name="nameOverride_active" data-action="toggleField" data-target="nameOverride" {{checked nameOverride.active}}>
                            <label>{{localize "VISAGE.GlobalEditor.NameOverride"}}</label>
                            <div class="visage-form-fields">
                                <input type="text" name="nameOverride" value="{{nameOverride.value}}" {{disabled (not nameOverride.active)}} placeholder="{{localize 'VISAGE.GlobalEditor.NameOverride'}}">
                            </div>
                        </div>

                        {{!-- Image --}}
                        <div class="form-group checkbox-input-group">
                            <input class="visage-checkbox" type="checkbox" name="img_active" data-action="toggleField" data-target="img" {{checked img.active}}>
                            <label>{{localize "VISAGE.GlobalEditor.TokenImage"}}</label>
                            <div class="visage-form-fields">
                                <input type="text" name="img" value="{{this.img.value}}" {{disabled (not img.active)}} placeholder="{{localize 'VISAGE.Config.Placeholder.Path'}}">
                                <button type="button" class="file-picker-button" data-action="openFilePicker" {{disabled (not img.active)}}><i class="visage-icon image-search"></i></button>
                            </div>
                        </div>

                        {{!-- Scale --}}
                        <div class="form-group checkbox-input-group">
                            <input class="visage-checkbox" type="checkbox" name="scale_active" data-action="toggleField" data-target="scale" {{checked scale.active}}>
                            <label>{{localize "VISAGE.Config.List.Scale"}}</label>
                            <div class="visage-form-fields">
                                <input type="number" name="scale" value="{{scale.value}}" step="1" {{disabled (not scale.active)}}>
                            </div>
                        </div>

                        {{!-- Opacity --}}
                        <div class="form-group checkbox-input-group">
                            <input class="visage-checkbox" type="checkbox" name="alpha_active" data-action="toggleField" data-target="alpha" {{checked alpha.active}}>
                            <label>{{localize "VISAGE.Config.Opacity.LabelPercent"}}</label>
                            <div class="visage-form-fields">
                                <input type="number" name="alpha" value="{{alpha.value}}" min="0" max="100" step="1" {{disabled (not alpha.active)}}>
                            </div>
                        </div>

                        {{!-- Disposition --}}
                        <div class="form-group checkbox-input-group">
                            <input class="visage-checkbox" type="checkbox" name="disposition_active" data-action="toggleField" data-target="disposition" {{checked disposition.active}}>
                            <label>{{localize "VISAGE.Disposition.Label"}}</label>
                            <div class="visage-form-fields">
                                <select name="disposition" {{disabled (not disposition.active)}}>
                                    <option value="1" {{visageSelected (eq disposition.value 1)}}>{{localize "VISAGE.Disposition.Friendly"}}</option>
                                    <option value="0" {{visageSelected (eq disposition.value 0)}}>{{localize "VISAGE.Disposition.Neutral"}}</option>
                                    <option value="-1" {{visageSelected (eq disposition.value -1)}}>{{localize "VISAGE.Disposition.Hostile"}}</option>
                                    <option value="-2" {{visageSelected (eq disposition.value -2)}}>{{localize "VISAGE.Disposition.Secret"}}</option>
                                </select>
                            </div>
                        </div>

                        {{!-- Dimensions --}}
                        <div class="form-group checkbox-input-group">
                            <input class="visage-checkbox" type="checkbox" name="width_active" data-action="toggleField" data-target="width" {{checked width.active}}>
                            <label>{{localize "VISAGE.Config.List.Width"}}</label>
                            <div class="visage-form-fields">
                                <input type="number" name="width" value="{{width.value}}" {{disabled (not width.active)}}>
                            </div>
                        </div>
                        <div class="form-group checkbox-input-group">
                            <input class="visage-checkbox" type="checkbox" name="height_active" data-action="toggleField" data-target="height" {{checked height.active}}>
                            <label>{{localize "VISAGE.Config.List.Height"}}</label>
                            <div class="visage-form-fields">
                                <input type="number" name="height" value="{{height.value}}" {{disabled (not height.active)}}>
                            </div>
                        </div>

                        <hr class="visage-divider">

                        {{!-- Rotation Lock --}}
                        <div class="form-group stacked">
                             <label>{{localize "VISAGE.RotationLock.Label"}}</label>
                             <div class="visage-form-fields">
                                <select name="lockRotation">
                                    <option value="" {{visageSelected (eq lockRotation.value "")}}>{{localize "VISAGE.RotationLock.Unset"}}</option>
                                    <option value="false" {{visageSelected (eq lockRotation.value "false")}}>{{localize "VISAGE.RotationLock.Off"}}</option>
                                    <option value="true" {{visageSelected (eq lockRotation.value "true")}}>{{localize "VISAGE.RotationLock.On"}}</option>
                                </select>
                             </div>
                        </div>

                        <hr class="visage-divider">

                         {{!-- Mirroring --}}
                        <div class="form-group stacked">
                             <label>{{localize "VISAGE.GlobalEditor.Mirroring"}}</label>
                             <div class="visage-form-fields mirroring-grid">
                                
                                {{!-- Row 1: Horizontal --}}
                                <label>{{localize "VISAGE.Mirror.Label.Horizontal"}}</label>
                                <select name="isFlippedX">
                                    <option value="" {{visageSelected (eq isFlippedX.value null)}}>{{localize "VISAGE.Mirror.Option.NoChange"}}</option>
                                    <option value="false" {{visageSelected (eq isFlippedX.value false)}}>{{localize "VISAGE.Mirror.Option.Standard"}}</option>
                                    <option value="true" {{visageSelected (eq isFlippedX.value true)}}>{{localize "VISAGE.Mirror.Option.Flipped"}}</option>
                                </select>

                                {{!-- Row 2: Vertical --}}
                                <label>{{localize "VISAGE.Mirror.Label.Vertical"}}</label>
                                <select name="isFlippedY">
                                    <option value="" {{visageSelected (eq isFlippedY.value null)}}>{{localize "VISAGE.Mirror.Option.NoChange"}}</option>
                                    <option value="false" {{visageSelected (eq isFlippedY.value false)}}>{{localize "VISAGE.Mirror.Option.Standard"}}</option>
                                    <option value="true" {{visageSelected (eq isFlippedY.value true)}}>{{localize "VISAGE.Mirror.Option.Flipped"}}</option>
                                </select>
                             </div>
                        </div>

                    </fieldset>
                </div>

                {{!-- TAB 2: RING --}}
                <div class="tab" data-tab="ring" data-group="primary">
                    <fieldset class="visage-fieldset inspector-fieldset">
                        
                        <div class="form-group">
                            <label class="master-toggle">
                                <input class="visage-checkbox" type="checkbox" name="ring.enabled" {{checked ring.active}}>
                                {{localize "VISAGE.GlobalEditor.RingEnable"}}
                            </label>
                        </div>

                        <div class="form-group">
                            <label>{{localize "VISAGE.RingConfig.RingColor"}}</label>
                            <div class="visage-form-fields">
                                <color-picker name="ringColor" value="{{ring.colors.ring}}"></color-picker>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>{{localize "VISAGE.RingConfig.BackgroundColor"}}</label>
                            <div class="visage-form-fields">
                                <color-picker name="ringBackgroundColor" value="{{ring.colors.background}}"></color-picker>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>{{localize "VISAGE.RingConfig.SubjectTexture"}}</label>
                            <div class="visage-form-fields">
                                <file-picker type="image" name="ringSubjectTexture" value="{{this.ring.subject.texture}}"></file-picker>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>{{localize "VISAGE.RingConfig.SubjectScale"}}</label>
                            <div class="visage-form-fields">
                                <range-picker name="ringSubjectScale" value="{{ring.subject.scale}}" min="0.5" max="3.0" step="0.1"></range-picker>
                            </div>
                        </div>

                        <div class="form-group stacked">
                            <label>{{localize "VISAGE.RingConfig.Effects.Label"}}</label>
                            <div class="visage-form-fields effects-grid">
                                {{#each ring.effects}}
                                <label class="checkbox">
                                    <input class="visage-checkbox" type="checkbox" name="effect_{{this.value}}" {{checked this.isActive}}>
                                    {{localize this.label}}
                                </label>
                                {{/each}}
                            </div>
                        </div>

                    </fieldset>
                </div>

                {{!-- TAB 3: EFFECTS --}}
                <div class="tab effects-tab-container" data-tab="effects" data-group="primary">
                    
                    {{#if hasSequencer}}
                        {{!-- VIEW 1: THE STACK --}}
                        <div class="visage-view view-list">
                            
                            <div class="effects-actions">
                                <button type="button" data-action="addVisual">
                                    <i class="visage-icon visual"></i> Add Visual
                                </button>
                                <button type="button" data-action="addAudio">
                                    <i class="visage-icon audio"></i> Add Audio
                                </button>
                            </div>

                            <div class="effect-stack-list">
                                {{#each effects}}
                                <div class="effect-card" data-id="{{this.id}}" data-action="editEffect">
                                    <div class="effect-icon">
                                        <i class="{{this.icon}}"></i>
                                    </div>
                                    <div class="effect-info">
                                        <span class="effect-name">{{this.label}}</span>
                                        <span class="effect-meta">{{this.metaLabel}}</span>
                                    </div>
                                    <div class="effect-controls">
                                        <button type="button" class="effect-btn" data-action="toggleEffect" title="{{localize 'VISAGE.Toggle'}}">
                                            {{#if this.disabled}}
                                            <i class="visage-icon visage-hidden"></i>
                                            {{else}}
                                            <i class="visage-icon visible"></i>
                                            {{/if}}
                                        </button>
                                        <button type="button" class="effect-btn delete" data-action="deleteEffect" title="{{localize 'VISAGE.Delete'}}">
                                            <i class="visage-icon delete"></i>
                                        </button>
                                    </div>
                                </div>
                                {{/each}}
                                
                                {{#unless effects.length}}
                                <div class="empty-placeholder" style="padding: 1rem; font-size: 0.8em;">
                                    No effects added.
                                </div>
                                {{/unless}}
                            </div>

                        </div>

                        {{!-- VIEW 2: THE INSPECTOR --}}
                        <div class="visage-view view-inspector">
                            
                            <header class="inspector-header">
                                <button type="button" class="back-btn" data-action="closeEffectInspector">
                                    <i class="visage-icon back"></i>
                                </button>
                                <h4 class="inspector-title">Effect Settings</h4>
                            </header>

                            <fieldset class="visage-fieldset inspector-fieldset">
                            
                            {{!-- SHARED: Label & Path --}}
                            <div class="form-group">
                                <label>{{localize "VISAGE.GlobalEditor.Label"}}</label>
                                <div class="visage-form-fields">
                                    <input type="text" name="effectLabel" value="{{inspector.label}}" placeholder="Effect Name">
                                </div>
                            </div>

                            <div class="form-group stacked">
                                <label>{{localize "VISAGE.Editor.Effects.Path"}}</label>
                                <div class="visage-form-fields">
                                    {{!-- Text Input for DB Key or File Path --}}
                                    <input type="text" name="effectPath" value="{{inspector.path}}" placeholder="e.g. jb2a.fire_bolt.red">
                                    
                                    <button type="button" data-action="openSequencerDatabase" data-tooltip="{{localize 'VISAGE.Editor.Effects.OpenDatabase'}}">
                                        <i class="visage-icon library"></i>
                                    </button>

                                    <button type="button" class="file-picker-button" data-action="openFilePicker" data-tooltip="{{localize 'VISAGE.Editor.Effects.OpenFile'}}">
                                        <i class="visage-icon open"></i>
                                    </button>
                                </div>
                                <p class="hint">{{localize "VISAGE.Editor.Effects.DatabaseHint"}}</p>
                            </div>

                            {{!-- VISUAL SPECIFIC CONTROLS --}}
                            {{#if (eq inspector.type 'visual')}}
                                
                                <div class="form-group">
                                    <label>{{localize "VISAGE.Config.List.Scale"}}</label>
                                    <div class="visage-form-fields">
                                        {{!-- Step 10 for percentage increments --}}
                                        <input type="number" name="effectScale" value="{{inspector.scale}}" step="10">
                                    </div>
                                </div>

                                    <div class="form-group">
                                        <label>{{localize "VISAGE.Config.Opacity.Label"}}</label>
                                        <div class="visage-form-fields">
                                            <range-picker name="effectOpacity" value="{{inspector.opacity}}" min="0" max="1" step="0.1"></range-picker>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label>{{localize "VISAGE.Editor.Effects.BlendMode"}}</label>
                                        <div class="visage-form-fields">
                                            <select name="effectBlendMode">
                                                <option value="normal" {{visageSelected (eq inspector.blendMode "normal")}}>{{localize "VISAGE.BlendMode.Normal"}}</option>
                                                <option value="screen" {{visageSelected (eq inspector.blendMode "screen")}}>{{localize "VISAGE.BlendMode.Screen"}}</option>
                                                <option value="multiply" {{visageSelected (eq inspector.blendMode "multiply")}}>{{localize "VISAGE.BlendMode.Multiply"}}</option>
                                                <option value="overlay" {{visageSelected (eq inspector.blendMode "overlay")}}>{{localize "VISAGE.BlendMode.Overlay"}}</option>
                                                <option value="lighten" {{visageSelected (eq inspector.blendMode "lighten")}}>{{localize "VISAGE.BlendMode.Lighten"}}</option>
                                                <option value="darken" {{visageSelected (eq inspector.blendMode "darken")}}>{{localize "VISAGE.BlendMode.Darken"}}</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="form-group rotation-group">
                                        <label>{{localize "VISAGE.Rotation.Label"}}</label>
                                        <div class="visage-form-fields">
                                            <input type="number" name="effectRotation" value="{{inspector.rotation}}" placeholder="0">
                                            <label class="rotation-random-toggle">
                                                <input type="checkbox" name="effectRotationRandom" class="visage-checkbox" {{checked inspector.rotationRandom}}>
                                                {{localize "VISAGE.Random"}}
                                            </label>
                                        </div>
                                    </div>

                                    <hr class="visage-divider">

                                    <div class="form-group">
                                        <label>{{localize "VISAGE.Editor.Effects.Layering"}}</label>
                                        <div class="visage-form-fields">
                                            <select name="effectZIndex">
                                                <option value="above" {{visageSelected (eq inspector.zOrder "above")}}>{{localize "VISAGE.Editor.Effects.Above"}}</option>
                                                <option value="below" {{visageSelected (eq inspector.zOrder "below")}}>{{localize "VISAGE.Editor.Effects.Below"}}</option>
                                            </select>
                                        </div>
                                    </div>

                                {{/if}}

                                {{!-- AUDIO SPECIFIC CONTROLS --}}
                                {{#if (eq inspector.type 'audio')}}
                                    
                                    <div class="form-group checkbox-input-group">
                                        <label>{{localize "VISAGE.Editor.Effects.Volume"}}</label>
                                        <div class="visage-form-fields">
                                            <range-picker name="effectVolume" value="{{inspector.opacity}}" min="0" max="1" step="0.1"></range-picker>
                                        </div>
                                    </div>
                                    
                                    <p class="hint" style="margin-top: 1rem;">
                                        <i class="fas fa-info-circle"></i> {{localize "VISAGE.Editor.Effects.AudioHint"}}
                                    </p>

                                {{/if}}

                            </fieldset>

                        </div>
                    {{else}}
                        {{!-- MISSING DEPENDENCY STATE --}}
                        <div class="empty-placeholder" style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center; color: var(--visage-color-text-muted); padding: 2rem;">
                            <i class="fas fa-cubes" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                            <h3 style="margin-bottom: 0.5rem; color: var(--visage-color-text-main);">{{localize "VISAGE.Editor.Effects.DependencyTitle"}}</h3>
                            <p style="max-width: 300px; line-height: 1.5;">{{localize "VISAGE.Editor.Effects.DependencyHint"}}</p>
                        </div>
                    {{/if}}
                </div>

            </section>
        </div>

    </div>

    {{!-- FOOTER --}}
    <footer class="visage-editor-footer">
        {{#if isLocal}}
        <button type="button" class="visage-reset-btn" data-action="resetSettings" data-tooltip="{{localize 'VISAGE.GlobalEditor.ResetTooltip'}}">
            <i class="visage-icon undo"></i> {{localize "VISAGE.GlobalEditor.Reset"}}
        </button>
        {{/if}}

        <button type="submit" class="visage-save {{#if isDirty}}dirty{{/if}}" data-action="save">
            <i class="visage-icon save-update"></i> 
            {{#if isLocal}}
                {{localize "VISAGE.GlobalEditor.Save.Local"}}
            {{else}}
                {{localize "VISAGE.GlobalEditor.Save.Global"}}
            {{/if}}
        </button>
    </footer>
</div>