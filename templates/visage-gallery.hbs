<div class="visage-directory-container">
    
    {{!-- SIDEBAR --}}
    <aside class="visage-sidebar">
        <div class="visage-mode-switcher">
            <button type="button" class="{{#unless isBin}}active{{/unless}}" data-action="toggleBin" data-mode="library">
                <i class="visage-icon library"></i> {{localize "VISAGE.Directory.Mode.Library"}}
            </button>
            <button type="button" class="{{#if isBin}}active{{/if}}" data-action="toggleBin" data-mode="bin">
                <i class="visage-icon delete"></i> {{localize "VISAGE.Directory.Mode.Bin"}}
            </button>
        </div>

        <div class="search-bar">
            <i class="visage-icon search"></i>
            <input type="text" value="{{filters.search}}" placeholder="{{localize 'VISAGE.Directory.SearchPlaceholder'}}">
            {{#if filters.search}}
            <a data-action="clearSearch"><i class="visage-icon close"></i></a>
            {{/if}}
        </div>

        {{#unless isBin}}
        <button class="visage-create-btn" data-action="create">
            <i class="visage-icon add"></i> 
            {{#if isLocal}}
                {{localize "VISAGE.Directory.CreateNew.Local"}}
            {{else}}
                {{localize "VISAGE.Directory.CreateNew.Global"}}
            {{/if}}
        </button>
        {{/unless}}

        <nav class="category-list">
            <h3 class="sidebar-header">{{localize "VISAGE.Directory.Categories"}}</h3>
            <ul class="visage-scrollable">
                <li class="{{#unless filters.category}}active{{/unless}}">
                    <a data-action="selectCategory" data-category="">{{localize "VISAGE.Directory.AllVisages"}}</a>
                </li>
                {{#each categories}}
                <li class="{{#if this.active}}active{{/if}}">
                    <a data-action="selectCategory" data-category="{{this.label}}">{{this.label}}</a>
                </li>
                {{/each}}
            </ul>
        </nav>

        <div class="visage-sidebar-actions">
            <button type="button" data-action="export" class="visage-action-btn" data-tooltip="VISAGE.Actions.Export">
                <i class="visage-icon save"></i> {{localize "VISAGE.Actions.Export"}}
            </button>
            <button type="button" data-action="import" class="visage-action-btn" data-tooltip="VISAGE.Actions.Import">
                <i class="visage-icon open"></i> {{localize "VISAGE.Actions.Import"}}
            </button>
        </div>
    </aside>

    {{!-- MAIN BROWSER --}}
    <main class="visage-browser">

        {{!-- TAG FILTER BAR --}}
        <div class="visage-filter-bar">
            <i class="visage-icon filter filter-icon" title="{{localize 'VISAGE.Directory.Filters'}}"></i>
            <div class="filter-pills">
                {{#each activeTags}}
                <button class="visage-pill active" data-action="toggleTag" data-tag="{{this.label}}">
                    {{this.label}} <i class="visage-icon close"></i>
                </button>
                {{/each}}
                {{#if (and activeTags.length popularTags.length)}}
                <div class="filter-divider"></div>
                {{/if}}
                {{#each popularTags}}
                <button class="visage-pill suggestion" data-action="toggleTag" data-tag="{{this.label}}">
                    <i class="visage-icon add"></i> {{this.label}}
                </button>
                {{/each}}
            </div>

            <div class="filter-divider"></div>

            <button class="clear-filters" data-action="toggleAutomationFilter" data-tooltip="{{localize 'VISAGE.Directory.FilterAutomation'}}" style="color: {{#if filters.automation}}var(--visage-color-accent){{else}}var(--visage-color-text-main-solid){{/if}};">
                <i class="visage-icon power"></i>
            </button>

            {{#if activeTags.length}}
            <button class="clear-filters" data-action="clearTags" data-tooltip="{{localize 'VISAGE.Directory.ClearTags'}}">
                <span class="visage-icon-clear"></span>
            </button>
            {{/if}}
        </div>
        
        {{!-- SECTIONED GRID --}}
        {{#if hasItems}}
        <div class="visage-browser-grid visage-scrollable">
            
            {{!-- SECTION 1: IDENTITIES --}}
            {{#if identities.length}}
            <div class="visage-section">
                <h4 class="visage-section-header">
                    <i class="visage-icon domino"></i> {{localize "VISAGE.Actions.ApplyIdentity"}}
                </h4>
                <div class="visage-grid">
                    {{#each identities}}
                        {{> "modules/visage/templates/parts/visage-card.hbs" this}}
                    {{/each}}
                </div>
            </div>
            {{/if}}

            {{!-- SECTION 2: OVERLAYS --}}
            {{#if overlays.length}}
            <div class="visage-section">
                <h4 class="visage-section-header">
                    <i class="visage-icon domino"></i> {{localize "VISAGE.Actions.ApplyOverlay"}}
                </h4>
                <div class="visage-grid">
                    {{#each overlays}}
                        {{> "modules/visage/templates/parts/visage-card.hbs" this}}
                    {{/each}}
                </div>
            </div>
            {{/if}}

        </div>
        {{else}}
        <div class="empty-directory">
            <p>{{#if isBin}}{{localize "VISAGE.Directory.EmptyBin"}}{{else}}{{localize "VISAGE.Directory.EmptyLibrary"}}{{/if}}</p>
        </div>
        {{/if}}

    </main>
</div>