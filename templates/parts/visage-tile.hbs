<div class="visage-tile {{this.themeClass}} {{#if this.isActive}}active{{/if}}" 
        data-action="selectVisage" 
        data-form-key="{{this.key}}"
        tabindex="0" 
        role="button" 
        aria-label="{{this.label}}" 
        aria-pressed="{{this.isActive}}">

    {{!-- 1. ABSOLUTE OVERLAYS (Outside the dashboard) --}}
    
    {{!-- Top Right: Active --}}
    {{#if this.isActive}}
    <div class="visage-chip" data-tooltip="{{localize 'VISAGE.Selector.Active'}}">
        <img src="modules/visage/icons/check_circle.svg"/>
    </div>
    {{/if}}
    
    {{!-- Top Left: Default --}}
    {{#if this.isDefault}}
    <div class="visage-default-indicator" data-tooltip="{{localize 'VISAGE.Selector.Default'}}">
        <img src="modules/visage/icons/stars.svg"/>
    </div>
    {{/if}}

    {{!-- Top Center: Data Chip (Scale/Dimensions/Anchors) --}}
    {{#if this.meta.showDataChip}}
    {{!-- Apply tooltip to the container if Anchor is active --}}
    <div class="visage-data-chip" {{#if this.meta.slots.anchor.active}}data-tooltip="{{localize 'VISAGE.Config.List.Anchor'}}: {{this.meta.slots.anchor.val}}"{{/if}}>
        
        {{!-- Dimensions --}}
        {{#if this.meta.slots.dim.active}}
        <span class="visage-size-value" style="font-weight: bold;">{{this.meta.slots.dim.val}}</span>
        {{/if}}

        {{!-- Scale --}}
        {{#if this.meta.slots.scale.active}}
        <span class="visage-scale-value">{{this.meta.slots.scale.val}}</span>
        {{/if}}

        {{!-- Anchor Icon --}}
        {{#if this.meta.slots.anchor.active}}
        <span><i class="visage-icon anchor" style="width: var(--filroden-font-size-xs); height: var(--filroden-font-size-xs);"></i></span>
        {{/if}}

    </div>
    {{/if}}

    {{!-- Bottom Center: Disposition --}}
    {{#if this.meta.showDispositionChip}}
    <div class="visage-disposition-chip {{this.meta.slots.disposition.class}}" data-tooltip="{{this.meta.slots.disposition.val}}">
        <span>{{this.meta.slots.disposition.val}}</span>
    </div>
    {{/if}}


    {{!-- 2. THE DASHBOARD (Sidebar + Preview) --}}
    <div class="visage-dashboard">
        
        {{!-- LEFT: Sidebar for Glyphs --}}
        <div class="visage-dashboard-sidebar">
            
            {{!-- Portrait --}}
            {{#if this.meta.hasPortrait}}
            <div class="visage-sidebar-glyph portrait" 
                 data-tooltip="{{this.meta.portraitTooltip}}"
                 data-tooltip-class="visage-tooltip">
                <i class="visage-icon portrait"></i>
            </div>
            {{/if}}

            {{!-- Effects --}}
            {{#if this.meta.showEffectsBadge}}
            <div class="visage-sidebar-glyph effects"
                 data-tooltip="{{this.meta.effectsTooltip}}"
                 data-tooltip-class="visage-tooltip">
                <i class="visage-icon wand-stars"></i>
            </div>
            {{/if}}

            {{!-- Left Column: Automation Indicator --}}
            {{#if this.automation.conditions.length}}
            <div class="visage-sidebar-glyph visage-automation-indicator {{#unless this.automation.enabled}}muted{{/unless}}" 
                data-tooltip="{{localize 'VISAGE.Editor.Triggers.AutomationTooltip'}}">
                <i class="visage-icon power"></i>
            </div>
            {{/if}}

            {{!-- Lock --}}
            {{#if this.meta.slots.lock.active}}
            <div class="visage-sidebar-glyph lock" data-tooltip="{{localize 'VISAGE.RotationLock.Label'}}">
                <i class="visage-icon lock"></i>
            </div>
            {{/if}}

            {{!-- Wildcard --}}
            {{#if this.isWildcard}}
            <div class="visage-sidebar-glyph wildcard" data-tooltip="{{localize 'VISAGE.Selector.Wildcard'}}">
                 <i class="visage-icon wildcard"></i>
            </div>
            {{/if}}
            
             {{!-- Flip --}}
            {{#if this.meta.showFlipBadge}}
            <div class="visage-sidebar-glyph flip" data-tooltip="{{localize 'VISAGE.Selector.Flipped'}}">
                <i class="visage-icon flip"></i>
            </div>
            {{/if}}
        </div>

        {{!-- RIGHT: Image Preview --}}
        <div class="visage-dashboard-preview">
            <div class="visage-image-wrapper">
                {{> "modules/visage/templates/parts/visage-preview.hbs" 
                    wrapperClass="visage-hud-content"
                    hasCheckerboard=true 
                    alpha=this.alpha
                    resolvedPath=this.resolvedPath 
                    name=this.label
                    isVideo=this.isVideo                                    
                    hasRing=this.meta.hasRing 
                    hasInvisibility=this.meta.hasInvisibility
                    hasPulse=this.meta.hasPulse
                    hasGradient=this.meta.hasGradient
                    hasWave=this.meta.hasWave
                    ringColor=this.meta.ringColor
                    ringBkg=this.meta.ringBkg
                    forceFlipX=this.isFlippedX
                    forceFlipY=this.isFlippedY
                    hasLight=this.meta.hasLight
                    lightColor=this.meta.lightColor
                    lightAlpha=this.meta.lightAlpha
                    lightDim=this.meta.lightDim
                    lightBright=this.meta.lightBright
                    lightSizePct=this.meta.lightSizePct
                    lightBrightPct=this.meta.lightBrightPct
                    lightAnimType=this.meta.lightAnimType
                    lightAnimDuration=this.meta.lightAnimDuration
                    lightAnimIntensity=this.meta.lightAnimIntensity
                }}
            </div>
        </div>
    </div>

    {{!-- 3. LABEL --}}
    <span class="visage-tile-name" data-tooltip="{{this.label}}">{{this.label}}</span>

</div>