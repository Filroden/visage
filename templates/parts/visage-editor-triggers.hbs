<div class="tab triggers-tab-container {{#if inspector.active}}editing{{/if}}" data-tab="triggers" data-group="primary">
    
    {{!-- VIEW 1: THE CONDITION LIST --}}
    <div class="visage-view view-list">
        
        {{!-- Master Enable & Behaviors --}}
        <div class="transition-settings-bar">
            <div class="form-group checkbox-input-group">
                <div class="visage-form-fields">
                    <input type="checkbox" class="visage-checkbox" name="automation.enabled" data-action="toggleAutomation" {{checked automation.enabled}}>
                </div>
                <label>
                    <i class="visage-icon power"></i> 
                    {{localize "VISAGE.Editor.Triggers.Enable"}}
                </label>
            </div>
        </div>

        {{!-- Actions & Logic Toggle --}}
        <div class="effects-actions {{#unless automation.enabled}}disabled-look{{/unless}}">
            <div class="logic-toggle delay-direction-toggle" data-tooltip="VISAGE.Editor.Triggers.LogicHint">
                <button type="button" class="delay-btn {{#if (eq automation.logic 'AND')}}active{{/if}}" data-action="toggleLogic" data-value="AND">
                    {{localize "VISAGE.Editor.Triggers.LogicAnd"}}
                </button>
                <button type="button" class="delay-btn {{#if (eq automation.logic 'OR')}}active{{/if}}" data-action="toggleLogic" data-value="OR">
                    {{localize "VISAGE.Editor.Triggers.LogicOr"}}
                </button>
            </div>

            <button type="button" data-action="addCondition" data-type="attribute" {{disabled (not automation.enabled)}}>
                <i class="visage-icon add"></i> {{localize "VISAGE.Editor.Triggers.AddAttribute"}}
            </button>
            <button type="button" data-action="addCondition" data-type="status" {{disabled (not automation.enabled)}}>
                <i class="visage-icon add"></i> {{localize "VISAGE.Editor.Triggers.AddStatus"}}
            </button>
            <button type="button" data-action="addCondition" data-type="event" {{disabled (not automation.enabled)}}>
                <i class="visage-icon add"></i> {{localize "VISAGE.Editor.Triggers.AddEvent"}}
            </button>
        </div>

        {{!-- Condition Cards --}}
        <div class="visage-effect-list visage-scrollable {{#unless automation.enabled}}disabled-look{{/unless}}">
            <div class="effect-group">
                <h3 class="group-header sticky">
                    <i class="visage-icon list"></i> {{localize "VISAGE.Editor.Triggers.Conditions"}}
                </h3>
                <div class="group-drop-zone">
                    {{#each automation.conditions}}
                        <div class="effect-card {{#if (eq ../inspector.conditionId this.id)}}active{{/if}} {{#if this.disabled}}visage-disabled{{/if}}" data-action="editCondition" data-id="{{this.id}}">
                            <div class="effect-info">
                                <span class="effect-name">{{localize this.typeKey}}</span>
                                <span class="effect-meta">{{this.summary}}</span>
                            </div>
                            <div class="effect-controls">
                                {{!-- Visibility Toggle --}}
                                <button type="button" class="effect-btn toggle-visibility" data-action="toggleCondition">
                                    <i class="visage-icon {{#if this.disabled}}visage-hidden{{else}}visible{{/if}}"></i>
                                </button>
                                
                                {{!-- Delete --}}
                                <button type="button" class="effect-btn" data-action="deleteCondition" data-id="{{this.id}}">
                                    <i class="visage-icon delete"></i>
                                </button>
                            </div>
                        </div>
                    {{/each}}
                    {{#unless automation.conditions.length}}
                        <div class="empty-group-placeholder">{{localize "VISAGE.Editor.Triggers.Empty"}}</div>
                    {{/unless}}
                </div>
            </div>
        </div>
    </div>

    {{!-- VIEW 2: THE INSPECTOR --}}
    <div class="visage-view view-inspector visage-scrollable">
        <input type="hidden" name="inspector.conditionId" value="{{inspector.conditionId}}">
        <header class="inspector-header">
            <button type="button" class="back-btn" data-action="closeConditionInspector">
                <i class="visage-icon back"></i>
            </button>
            <h4 class="inspector-title">{{localize "VISAGE.Editor.Triggers.InspectorTitle"}}</h4>
        </header>

        <fieldset class="visage-fieldset inspector-fieldset">
            
            {{!-- ATTRIBUTE CONDITION CONFIGURATION --}}
            {{#if (eq inspector.condition.type 'attribute')}}
                <div class="form-group stacked">
                    <label>
                        {{localize "VISAGE.Editor.Triggers.DataPath"}}
                        <i class="visage-icon info" data-tooltip="{{localize 'VISAGE.Editor.Triggers.DataPathHint'}}"></i>
                    </label>
                    <div class="visage-form-fields" style="display: flex; gap: 0.5rem;">
                        <input type="text" name="inspector.path" value="{{inspector.condition.path}}" placeholder="e.g. system.attributes.hp.value">
                        <button type="button" class="file-picker-button" data-action="openAttributePicker" data-target="inspector.path" data-tooltip="{{localize 'VISAGE.Editor.Triggers.AttributePicker'}}">
                            <i class="visage-icon attribute-picker"></i>
                        </button>
                    </div>
                </div>

                <div class="form-group fade-grid">
                    <label>{{localize "VISAGE.Editor.Triggers.Operator"}}</label>
                    <select name="inspector.operator">
                        <option value="lte" {{visageSelected (eq inspector.condition.operator "lte")}}>{{localize "VISAGE.Editor.Triggers.OpLte"}}</option>
                        <option value="gte" {{visageSelected (eq inspector.condition.operator "gte")}}>{{localize "VISAGE.Editor.Triggers.OpGte"}}</option>
                        <option value="eq" {{visageSelected (eq inspector.condition.operator "eq")}}>{{localize "VISAGE.Editor.Triggers.OpEq"}}</option>
                        <option value="neq" {{visageSelected (eq inspector.condition.operator "neq")}}>{{localize "VISAGE.Editor.Triggers.OpNeq"}}</option>
                    </select>

                    <label>{{localize "VISAGE.Editor.Triggers.Value"}}</label>
                    <input type="number" name="inspector.value" value="{{inspector.condition.value}}" step="0.1">
                </div>

                <div class="form-group">
                    <label>{{localize "VISAGE.Editor.Triggers.Mode"}}</label>
                    <div class="visage-form-fields">
                        <select name="inspector.mode">
                            <option value="absolute" {{visageSelected (eq inspector.condition.mode "absolute")}}>{{localize "VISAGE.Editor.Triggers.ModeAbsolute"}}</option>
                            <option value="percent" {{visageSelected (eq inspector.condition.mode "percent")}}>{{localize "VISAGE.Editor.Triggers.ModePercent"}}</option>
                        </select>
                    </div>
                </div>

                {{!-- Dynamic Field: Denominator Path (Only shown for Percent mode) --}}
                {{#if (eq inspector.condition.mode 'percent')}}
                <div class="form-group stacked">
                    <label>
                        {{localize "VISAGE.Editor.Triggers.DenominatorPath"}}
                        <i class="visage-icon info" data-tooltip="{{localize 'VISAGE.Editor.Triggers.DenominatorHint'}}"></i>
                    </label>
                    <div class="visage-form-fields" style="display: flex; gap: 0.5rem;">
                        <input type="text" name="inspector.denominatorPath" value="{{inspector.condition.denominatorPath}}" placeholder="{{localize 'VISAGE.Editor.Triggers.DenominatorPlaceholder'}}">
                        <button type="button" class="file-picker-button" data-action="openAttributePicker" data-target="inspector.denominatorPath" data-tooltip="{{localize 'VISAGE.Editor.Triggers.AttributePicker'}}">
                            <i class="visage-icon attribute-picker"></i>
                        </button>
                    </div>
                </div>
                {{/if}}
            {{/if}}

            {{!-- STATUS CONDITION CONFIGURATION --}}
            {{#if (eq inspector.condition.type 'status')}}
                <div class="form-group stacked">
                    <label>{{localize "VISAGE.Editor.Triggers.StatusId"}} ({{localize "VISAGE.Editor.Triggers.CoreStatus"}})</label>
                    <div class="visage-form-fields">
                        <select name="inspector.statusId">
                            <option value="">{{localize "VISAGE.Editor.Triggers.CustomOrNoneStatus"}}</option>
                            {{#each statusEffects}}
                                <option value="{{this.value}}" {{visageSelected (eq ../inspector.condition.statusId this.value)}}>{{this.label}}</option>
                            {{/each}}
                        </select>
                    </div>
                </div>
                
                <div class="form-group stacked">
                    <label>{{localize "VISAGE.Editor.Triggers.CustomStatusName"}}</label>
                    <div class="visage-form-fields">
                        <input type="text" name="inspector.customStatus" value="{{inspector.condition.customStatus}}" placeholder="{{localize 'VISAGE.Editor.Triggers.CustomStatusPlaceholder'}}">
                    </div>
                </div>

                <div class="form-group">
                    <label>{{localize "VISAGE.Editor.Triggers.Operator"}}</label>
                    <div class="visage-form-fields">
                        <select name="inspector.operator">
                            <option value="active" {{visageSelected (eq inspector.condition.operator "active")}}>{{localize "VISAGE.Editor.Triggers.StatusActive"}}</option>
                            <option value="inactive" {{visageSelected (eq inspector.condition.operator "inactive")}}>{{localize "VISAGE.Editor.Triggers.StatusInactive"}}</option>
                        </select>
                    </div>
                </div>
            {{/if}}

            {{!-- EVENT CONDITION CONFIGURATION --}}
            {{#if (eq inspector.condition.type 'event')}}
                <div class="form-group">
                    <label>{{localize "VISAGE.Editor.Triggers.EventId"}}</label>
                    <div class="visage-form-fields">
                        <select name="inspector.eventId">
                            <option value="combat" {{visageSelected (eq inspector.condition.eventId "combat")}}>{{localize "VISAGE.Editor.Triggers.EventCombat"}}</option>
                            <option value="elevation" {{visageSelected (eq inspector.condition.eventId "elevation")}}>{{localize "VISAGE.Editor.Triggers.EventElevation"}}</option>
                            <option value="darkness" {{visageSelected (eq inspector.condition.eventId "darkness")}}>{{localize "VISAGE.Editor.Triggers.EventDarkness"}}</option>
                            <option value="globalLight" {{visageSelected (eq inspector.condition.eventId "globalLight")}}>{{localize "VISAGE.Editor.Triggers.EventGlobalLight"}}</option>
                            <option value="region" {{visageSelected (eq inspector.condition.eventId "region")}}>{{localize "VISAGE.Editor.Triggers.EventRegion"}}</option>
                            <option value="targeted" {{visageSelected (eq inspector.condition.eventId "targeted")}}>{{localize "VISAGE.Editor.Triggers.EventTargeted"}}</option>
                        </select>
                    </div>
                </div>

                {{!-- Dynamic Fields: Combat, Targeted, & Global Light (Binary State) --}}
                {{#if (or (eq inspector.condition.eventId 'combat') (or (eq inspector.condition.eventId 'targeted') (eq inspector.condition.eventId 'globalLight')))}}
                    <div class="form-group">
                        <label>{{localize "VISAGE.Editor.Triggers.State"}}</label>
                        <div class="visage-form-fields">
                            <select name="inspector.operator">
                                <option value="active" {{visageSelected (eq inspector.condition.operator "active")}}>{{localize "VISAGE.Editor.Triggers.EventActive"}}</option>
                                <option value="inactive" {{visageSelected (eq inspector.condition.operator "inactive")}}>{{localize "VISAGE.Editor.Triggers.EventInactive"}}</option>
                            </select>
                        </div>
                    </div>
                {{/if}}

                {{!-- Dynamic Fields: Elevation & Darkness (Math Operators) --}}
                {{#if (or (eq inspector.condition.eventId 'elevation') (eq inspector.condition.eventId 'darkness'))}}
                    <div class="form-group fade-grid">
                        <label>{{localize "VISAGE.Editor.Triggers.Operator"}}</label>
                        <select name="inspector.operator">
                            <option value="gt" {{visageSelected (eq inspector.condition.operator "gt")}}>{{localize "VISAGE.Editor.Triggers.OpGt"}} (>)</option>
                            <option value="lt" {{visageSelected (eq inspector.condition.operator "lt")}}>{{localize "VISAGE.Editor.Triggers.OpLt"}} (<)</option>
                            {{#if (eq inspector.condition.eventId 'elevation')}}
                                <option value="eq" {{visageSelected (eq inspector.condition.operator "eq")}}>{{localize "VISAGE.Editor.Triggers.OpEq"}} (==)</option>
                            {{/if}}
                        </select>

                        <label>{{localize "VISAGE.Editor.Triggers.Value"}}</label>
                        <input type="number" name="inspector.value" value="{{inspector.condition.value}}" 
                               step="{{#if (eq inspector.condition.eventId 'darkness')}}0.05{{else}}1{{/if}}" 
                               {{#if (eq inspector.condition.eventId 'darkness')}}min="0" max="1"{{/if}}>
                    </div>
                {{/if}}

                {{!-- Dynamic Fields: Region (ID & Entry/Exit) --}}
                {{#if (eq inspector.condition.eventId 'region')}}
                    <div class="form-group stacked">
                        <label>{{localize "VISAGE.Editor.Triggers.RegionId"}}</label>
                        <div class="visage-form-fields">
                            <input type="text" name="inspector.regionId" value="{{inspector.condition.regionId}}" placeholder="e.g. 'LavaPit' or Region ID">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>{{localize "VISAGE.Editor.Triggers.State"}}</label>
                        <div class="visage-form-fields">
                            <select name="inspector.operator">
                                <option value="active" {{visageSelected (eq inspector.condition.operator "active")}}>{{localize "VISAGE.Editor.Triggers.RegionEnter"}}</option>
                                <option value="inactive" {{visageSelected (eq inspector.condition.operator "inactive")}}>{{localize "VISAGE.Editor.Triggers.RegionExit"}}</option>
                            </select>
                        </div>
                    </div>
                {{/if}}
            {{/if}}

        </fieldset>
    </div>
</div>