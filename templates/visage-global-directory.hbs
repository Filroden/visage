<div class="visage-directory-container">
    
    {{!-- SIDEBAR --}}
    <aside class="visage-sidebar">
        
        {{!-- MODE SWITCHER (TABS) --}}
        <div class="visage-mode-switcher">
            <button type="button" class="{{#unless isBin}}active{{/unless}}" data-action="toggleBin" data-mode="library">
                <i class="fas fa-book-open"></i> {{localize "VISAGE.Directory.Mode.Library"}}
            </button>
            <button type="button" class="{{#if isBin}}active{{/if}}" data-action="toggleBin" data-mode="bin">
                <i class="fas fa-trash"></i> {{localize "VISAGE.Directory.Mode.Bin"}}
            </button>
        </div>

        {{!-- SEARCH --}}
        <div class="search-bar">
            <i class="fas fa-search"></i>
            <input type="text" value="{{filters.search}}" placeholder="{{localize 'VISAGE.Directory.SearchPlaceholder'}}">
            {{#if filters.search}}
            <a data-action="clearSearch"><i class="fas fa-times"></i></a>
            {{/if}}
        </div>

        {{!-- CREATE BTN --}}
        {{#unless isBin}}
        <button class="visage-create-btn" data-action="create">
            <i class="fas fa-plus"></i> {{localize "VISAGE.Directory.CreateNew"}}
        </button>
        {{/unless}}

        {{!-- CATEGORY PILLS --}}
        <nav class="category-list">
            <h3 class="sidebar-header">{{localize "VISAGE.Directory.Categories"}}</h3>
            <ul>
                <li class="{{#unless filters.category}}active{{/unless}}">
                    <a data-action="selectCategory" data-category="">{{localize "VISAGE.Directory.AllVisages"}}</a>
                </li>
                {{#each categories}}
                <li class="{{#if this.active}}active{{/if}}">
                    <a data-action="selectCategory" data-category="{{this.label}}">{{this.label}}</a>
                </li>
                {{/each}}
            </ul>
        </nav>
    </aside>

    {{!-- MAIN BROWSER --}}
    <main class="visage-browser">
        
        {{#if items.length}}
        <div class="visage-browser-grid">
            {{#each items}}
            <div class="visage-card" data-id="{{this.id}}" draggable="true">
                
                {{!-- CARD BODY (3 ZONES) --}}
                <div class="card-body">
                    
                    {{!-- LEFT: METADATA (Fixed Slots) --}}
                    <div class="card-zone-left">
                        
                        {{!-- Slot 1: Scale --}}
                        <div class="metadata-slot {{#unless this.meta.slots.scale.active}}inactive{{/unless}}" 
                             data-tooltip="{{localize 'VISAGE.Directory.Tooltip.Scale'}}">
                            <i class="fas fa-ruler-combined"></i>
                            <span class="slot-value">{{this.meta.slots.scale.val}}</span>
                        </div>

                        {{!-- Slot 2: Dimensions --}}
                        <div class="metadata-slot {{#unless this.meta.slots.dim.active}}inactive{{/unless}}"
                             data-tooltip="{{localize 'VISAGE.Directory.Tooltip.Dimensions'}}">
                            <i class="fas fa-vector-square"></i>
                            <span class="slot-value">{{this.meta.slots.dim.val}}</span>
                        </div>

                        {{!-- Slot 3: Orientation --}}
                        <div class="metadata-slot {{#unless this.meta.slots.flip.active}}inactive{{/unless}}"
                             data-tooltip="{{localize 'VISAGE.Directory.Tooltip.Orientation'}}">
                            <i class="{{this.meta.slots.flip.icon}}"></i>
                            <span class="slot-value">{{this.meta.slots.flip.val}}</span>
                        </div>

                        {{!-- Slot 4: Disposition (Bottom) --}}
                        <div class="metadata-slot disposition-slot">
                            <div class="visage-disposition-chip {{this.meta.slots.disposition.class}}">
                                {{this.meta.slots.disposition.val}}
                            </div>
                        </div>

                    </div>

                    {{!-- CENTER: VISUAL PREVIEW --}}
                    <div class="card-zone-center">
                        <div class="visual-target">
                            {{> "modules/visage/templates/parts/visage-preview.hbs" 
                                resolvedPath=this.changes.img 
                                name=this.label
                                hasRing=this.meta.hasRing 
                                hasInvisibility=this.meta.hasInvisibility
                                hasPulse=this.meta.hasPulse
                                hasGradient=this.meta.hasGradient
                                hasWave=this.meta.hasWave
                                ringColor=this.meta.ringColor
                                ringBkg=this.meta.ringBkg
                                forceFlipX=this.meta.forceFlipX
                                forceFlipY=this.meta.forceFlipY
                            }}
                        </div>
                        
                        {{!-- Token Name --}}
                        {{#if this.meta.tokenName}}
                            <div class="token-name-label">{{this.meta.tokenName}}</div>
                        {{/if}}

                    </div>

                    {{!-- RIGHT: ACTIONS --}}
                    <div class="card-zone-right">
                        {{#if ../isBin}}
                            <button data-action="restore" data-tooltip="{{localize 'VISAGE.Directory.Tooltip.Restore'}}"><i class="fas fa-trash-restore"></i></button>
                            <button data-action="destroy" data-tooltip="{{localize 'VISAGE.Directory.Tooltip.Destroy'}}" class="danger"><i class="fas fa-ban"></i></button>
                        {{else}}
                            <button data-action="apply" data-tooltip="{{localize 'VISAGE.Directory.Tooltip.Apply'}}"><i class="fas fa-check"></i></button>
                            <button data-action="edit" data-tooltip="{{localize 'VISAGE.Directory.Tooltip.Edit'}}"><i class="fas fa-edit"></i></button>
                            <button data-action="delete" data-tooltip="{{localize 'VISAGE.Directory.Tooltip.Delete'}}" class="danger"><i class="fas fa-trash"></i></button>
                        {{/if}}
                    </div>

                </div>

                {{!-- FOOTER: LABEL --}}
                <div class="card-footer">
                    <h4 class="card-title">{{this.label}}</h4>
                    {{#if this.tags}}
                    <div class="card-tags">
                        {{#each this.tags}}
                        <span class="tag">{{this}}</span>
                        {{/each}}
                    </div>
                    {{/if}}
                </div>
            </div>
            {{/each}}
        </div>
        {{else}}
        <div class="empty-directory">
            <p>{{#if isBin}}{{localize "VISAGE.Directory.EmptyBin"}}{{else}}{{localize "VISAGE.Directory.EmptyLibrary"}}{{/if}}</p>
        </div>
        {{/if}}

    </main>
</div>