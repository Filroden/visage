<div dir="rtl">

# Visage

اقرأ بلغات أخرى: [English](README.md) • [Français](README-fr.md)

![أحدث إصدار](https://img.shields.io/badge/Version-1.3.0-blue)
![إصدار Foundry](https://img.shields.io/badge/Foundry_VTT-v13_%7C_v13-orange)
![الترخيص](https://img.shields.io/badge/License-MIT-yellow)
![دعم RTL](https://img.shields.io/badge/RTL-Supported-green)
![اللغات](https://img.shields.io/badge/Languages-3-blueviolet)
![عدد التنزيلات](https://img.shields.io/github/downloads/Filroden/visage/total)
![آخر التزام](https://img.shields.io/github/last-commit/Filroden/visage)
![المشكلات](https://img.shields.io/github/issues/Filroden/visage)

**Visage** يسمح للاعبين و GMs بتبديل مظهر الرمز المميز والتصرف وتكوين حلقة الرمز الديناميكي على الفور.

يمكن للمالكين تكوين **وتخزين أشكال بديلة متعددة** (Visages) لأي ممثل - والتي يتم حفظها باستمرار ومتاحة لجميع الرموز المميزة المرتبطة به عبر جميع المشاهد. باستخدام **محدد HUD للرمز المميز** المخصص القائم على الشبكة ، يمكنك تبديل صورة الرمز المميز واسمه ، وضبط مقياسه المرئي (على سبيل المثال ، 150٪ للتكبير) ، وقلب اتجاهه ، وتطبيق تصرف (حالة "صديق" أو "محايد" أو "عدائي" أو "سري") وإعادة تكوين إعدادات حلقة الرمز الديناميكي بالكامل (الألوان والتأثيرات وملمس الموضوع).

يدعم الوحدة:

* **جميع تنسيقات الصور أو الفيديو** الصالحة للرموز المميزة.
* **يدعم مسارات الملفات ذات الأحرف البدل** (على سبيل المثال ، `path/to/wolves/*.webp`) ، مما يتيح لك تحديد صورة عشوائية من مجلد في كل مرة يتم فيها تنشيط **Visage**.

يجعل هذا الوحدة مثاليًا للعب الديناميكي دون الحاجة إلى تعديلات يدوية تستغرق وقتًا طويلاً في نافذة تكوين الرمز المميز الأساسية في كل تغيير.

هذا هو الوحدة المثالي لحل آليات اللعبة الشائعة بصريًا عبر أي نظام. استخدم **Visage** للتطبيق السريع **للأوهام** و **التنكرات** التي تغير مظهر الرمز المميز واسمه لخداع الخصوم. قم بتبسيط قدرات **تغيير الشكل** عن طريق التبديل بصريًا إلى صورة أخرى بنقرة واحدة. إنها أيضًا أداة ممتازة لإظهار التأثيرات المرئية ، مثل تغيير المقياس لتمثيل الرمز المميز الذي يصبح أصغر أو أكبر.

يزيد **Visage** من الانغماس وسرعة الطاولة عن طريق وضع عناصر تحكم مرئية قوية مباشرة داخل Token HUD ، مما يوفر **وصولاً بنقرة واحدة إلى جميع النماذج البديلة المخزنة**.

[سجل الإصدارات](VERSION.md)

## التعريب وإمكانية الوصول

تم تصميم **Visage** ليكون متاحًا:

* **واجهة مستخدم سريعة الاستجابة**: الواجهة سريعة الاستجابة تمامًا للتغييرات في حجم الخط الأساسي وتتوسع بشكل طبيعي للمستخدمين الذين يحتاجون إلى نص أكبر.
* **دعم RTL الأصلي**: يتضمن دعمًا كاملاً من **اليمين إلى اليسار (RTL)**. إذا تم تعيين عميل Foundry الخاص بك على لغة RTL (مثل العربية والعبرية) ، فإن واجهة مستخدم Visage (Selector HUD ونافذة التكوين ومحرر الحلقة الديناميكية) تعكس تلقائيًا تخطيطها لضمان تجربة قراءة طبيعية.
* **اللغات**: يدعم حاليًا العربية والإنجليزية (الولايات المتحدة) والفرنسية.

## الترخيص

البرامج وملفات التوثيق المرتبطة بها في هذا المستودع مغطاة [بترخيص MIT](LICENSE.md).

## خارطة طريق

[على المدى القصير]

* تعريب إضافي.

[على المدى الطويل]

* أضف القدرة على إنشاء واستخدام دليل عالمي للوجوه ، بحيث يمكن تطبيق تأثيرات معينة بسرعة على أي رمز مميز (على سبيل المثال ، تأثيرات التكبير / التصغير).
* اختبار الوحدة مقابل FoundryVTT v14.

## كيفية استخدام Visage

يجعل **Visage** من السهل تبديل مظهر الرمز المميز واسمه وحالته الميكانيكية بسرعة. إليك كيفية إعداده واستخدامه.

### 1. تكوين الوجوه

قبل أن تتمكن من تبديل **الوجوه** ، تحتاج إلى تحديدها لرمز مميز. يتم تخزين هذه **الوجوه** على الممثل وهي متاحة لجميع رموز هذا الممثل.

1. **افتح تكوين Visage**: انقر بزر الماوس الأيمن على رمز مميز واختر أيقونة **Visage** في Token HUD (رمز "تبديل الحساب") لفتح **Visage Selector HUD**. في الزاوية اليمنى العليا ، انقر فوق أيقونة الإعدادات ("الترس") لفتح نافذة **تكوين Visage**.
2. **مراجعة إعدادات Visage الافتراضية**:
    * تعرض نافذة **تكوين Visage** الاسم الافتراضي الحالي للرمز المميز ومسار الصورة. هذه هي الإعدادات التي سيحصل عليها الرمز المميز عند تعيين **Visage** الخاص به على "افتراضي".
    * بشكل افتراضي ، يتم توريثها من الإعدادات الرئيسية للممثل. ومع ذلك ، يمكنك تجاوزها عن طريق تغيير اسم / صورة / تصرف الرمز المميز في نافذة التكوين الرئيسية للرمز المميز. يتتبع **Visage** هذه التغييرات تلقائيًا.
3. **إضافة وجوه بديلة**:
    * انقر فوق الزر "**إضافة وجه**" لإنشاء نموذج بديل جديد.
    * لكل **وجه** ، يجب عليك توفير:
        * **الاسم**: اسم **الوجه** (على سبيل المثال ، "[الاسم] (شكل ذئب)" ، "[الاسم] (مكبر)" ، "برميل"). سيتم استخدام هذا الاسم أيضًا لاسم الرمز المميز عندما يكون هذا **الوجه** نشطًا ، لذا تذكر أن هذا ما سيراه اللاعبون الآخرون. **هذا اختياري**.
            * إذا تركت هذا الحقل فارغًا ، فسيستخدم Visage الاسم الافتراضي الحالي للرمز المميز عند تطبيقه.
            * إذا قدمت اسمًا ، فسيتجاوز اسم الرمز المميز كالمعتاد.
        * **مسار الصورة**: مسار ملف الصورة لهذا **الوجه**. **هذا اختياري**.
            * إذا تركت هذا الحقل فارغًا ، فسيستخدم Visage الصورة الافتراضية الحالية للرمز المميز عند تطبيقها.
            * يمكنك استخدام أيقونة المجلد لفتح منتقي الملفات. يتم دعم أحرف البدل (`*`) (على سبيل المثال ، `path/to/images/wolf_*.webp`).
        * **المقياس**: عامل مقياس النسبة المئوية (على سبيل المثال ، "100٪" ، "80٪" ، "150٪"). سيؤدي ذلك إلى تكبير أو تصغير صورة الرمز المميز بصريًا على اللوحة  دون تغيير حجمها الفعلي. الإعداد الافتراضي هو "100٪" (بدون تغيير).
        * **قلب**: إذا تم تحديده ، فسيتم قلب الصورة أفقيًا.
        * **التصرف**: يتحكم في تصرف الرمز المميز (لون الحدود والتفاعل) عندما يكون هذا **الوجه** نشطًا. بجانب مربع اختيار القلب ، يوجد زر **التصرف** يعرض الإعداد الحالي (على سبيل المثال ، "افتراضي" ، "تنكر: صديق" ، "وهم: سري").
            * يؤدي النقر فوق هذا الزر إلى فتح نافذة منبثقة حيث يمكنك اختيار أحد التجاوزات التالية:
                * **افتراضي (بدون تغيير)**: لن يؤثر **الوجه** على تصرف الOرمز المميز. سيحتفظ بأي تصرف لدى الرمز المميز حاليًا أو سيعود إلى وضعه الافتراضي الأصلي إذا تم التبديل مرة أخرى إلى **الوجه** "الافتراضي".
                * **تنكر كـ**: حدد **صديق** أو **محايد** أو **عدائي**. يؤدي هذا إلى تغيير لون حدود الرمز المميز وكيف يمكن للآخرين إدراكه.
                * **الوهم (سري)**: يضبط الرمز المميز على الحالة **السرية** (حد أرجواني للمالك ، وغير تفاعلي للآخرين). هذا حصري بشكل متبادل مع صديق / محايد / عدائي.
        * **الحلقة الديناميكية**: انقر فوق زر أيقونة الهدف لفتح محرر الحلقة.
            * **تمكين تجاوز الحلقة**: حدد هذا لفرض إعدادات حلقة معينة لهذا الوجه. إذا لم يتم تحديده ، فسيرث الوجه إعدادات الحلقة الحالية للرمز المميز.
            * **الموضوع**: يمكنك تجاوز النسيج المستخدم داخل الحلقة (اتركه فارغًا لاستخدام صورة Visage الرئيسية) وضبط تصحيح مقياس الموضوع بشكل مستقل.
            * **الألوان**: حدد لون الحلقة ولون الخلفية.
            * **التأثيرات**: قم بتمكين رسوم متحركة خاصة للحلقة مثل النبض أو التدرج أو الموجة أو الاختفاء.
4. **حذف الوجوه البديلة**: انقر فوق أيقونة سلة المهملات لحذف **الوجه**.
5. **حفظ التغييرات**: إذا قمت بإجراء أي تغييرات (إضافة **وجه** جديد ، أو تغيير قيمة في **وجه** موجود ، أو حذف **وجه**) ، فسيتم تمييز زر "حفظ التغييرات". سيؤدي النقر فوقه إلى حفظ التغييرات وإغلاق نافذة **تكوين Visage**.

<img src="images/visage_configuration.png" alt="نافذة تكوين Visage" width="500" style="display: block; margin: 0 auto;">
<br>
<img src="images/ring_editor.png" alt="محرر الحلقة الديناميكية Visage" height="500" style="display: block; margin: 0 auto;">

### 2. تحديد وجه

بمجرد التكوين ، يكون التبديل بين **الوجوه** بسيطًا.

1. **افتح Token HUD**: انقر فوق رمز مميز قمت بتكوينه لإظهار Token HUD.
2. **انقر فوق أيقونة Visage**: سترى أيقونة (رمز "تبديل الحساب"). انقر فوق هذا لفتح **Visage Selector HUD**.
3. **اختر وجهًا**: ستظهر شبكة بجوار الرمز المميز تعرض جميع **الوجوه** المتاحة التي قمت بتكوينها:
    * يحتوي **الوجه** "الافتراضي" للرمز المميز على أيقونة نجمة ذهبية في الزاوية اليسرى العليا.
    * يتم تمييز **الوجه** النشط بأيقونة اختيار خضراء في الزاوية اليمنى العليا.
    * إذا كان لدى **الوجه** مقياس ليس 100٪ أو تم تمكين القلب فيه ، فسيتم عرض ذلك في شريحة على الحدود العلوية.
    * إذا كان **الوجه** يستخدم حرف بدل في مسار ملفه ، فسيعرض أيقونة خلط ورق اللعب زرقاء في الزاوية اليسرى السفلية. سيؤدي تحديده مرة أخرى إلى اختيار صورة عشوائية أخرى.
    * إذا قام **الوجه** بتغيير تصرف الرمز المميز ، فستظهر شريحة ملونة في أسفل الوسط تشير إلى الحالة (على سبيل المثال ، "صديق" ، "عدائي" ، "سري") ، مطابقة لألوان التصرف في Foundry.
    * إذا كان **الوجه** يستخدم حلقة رمز ديناميكي ، فسيعرض **الوجه** الحلقة بألوانك وخلفيتك وأي تأثيرات للرسوم المتحركة ، مما يمنحك معاينة فورية للتأثير.
4. **انقر للتبديل**: ما عليك سوى النقر فوق **وجه** في الشبكة. سيتم تحديث صورة الرمز المميز واسمه ومقياسه وقلبه وتصرفه على الفور لمطابقة اختيارك ، وسيتم إغلاق المحدد.

<img src="images/selector_hud.png" alt="Visage Selector HUD يعرض الوجوه المتاحة وتغييراتها المحفوظة" height="500" style="display: block; margin: 0 auto;">

### 3. استعادة الإعدادات الافتراضية

لإعادة رمز مميز إلى مظهره الأصلي:

1. افتح **Visage Selector HUD** من Token HUD.
2. انقر فوق **الوجه** الافتراضي (المميز بنجمة ذهبية في الزاوية اليسرى العليا).
3. سيعود الرمز المميز إلى الاسم الافتراضي والصورة والمقياس وحالة القلب والتصرف الذي التقطه **Visage** تلقائيًا له.

### 4. حذف جميع البيانات المتعلقة بـ Visage

بالنسبة إلى GMs ، يوفر الوحدة إعدادين يزيلان جميع البيانات المتعلقة بـ Visage إما من جميع الرموز المميزة في مشهد أو من جميع الرموز المميزة في جميع المشاهد. استخدم هذا بحذر لأنه لا يمكن التراجع عنه.

## وحدة Visage: وثائق API العامة

تعرض وحدة **Visage** واجهة برمجة تطبيقات عامة تسمح للوحدات الأخرى أو وحدات ماكرو النظام أو المستخدمين المتقدمين بالتفاعل برمجيًا مع وظائفها الأساسية ، مثل تبديل نماذج الممثل.

يمكن الوصول إلى واجهة برمجة التطبيقات عبر `game.modules.get('visage').api`.

-----

### الوصول إلى واجهة برمجة التطبيقات

للوصول إلى أي من الوظائف الموضحة أدناه ، يجب أولاً الحصول على مرجع لكائن API:

```javascript
const visageAPI = game.modules.get('visage')?.api;

if (!visageAPI) {
    console.error("Visage API غير متاح.");
    return;
}
// يمكنك الآن استدعاء الوظائف ، على سبيل المثال ، visageAPI.setVisage (...)
```

-----

### طرق API

#### 1. setVisage

الوظيفة الأساسية لتبديل الرمز المميز المحدد إلى نموذج المظهر المحدد وتطبيق التجاوزات المكونة له.

| المعلمة | النوع | الوصف |
| :--- | :--- | :--- |
| `actorId` | `string` | معرف مستند الممثل المرتبط بالرمز المميز. |
| `tokenId` | `string` | معرف رمز مميز معين على **اللوحة** لتحديثه على الفور. |
| `formKey` | `string` | المعرف الفريد (UUID) لنموذج المظهر للتبديل إليه (على سبيل المثال ، `"a1b2c3d4e5f6g7h8"`). استخدم السلسلة الحرفية `"default"` للتبديل إلى الصورة الافتراضية الملتقطة للرمز المميز والاسم والمقياس والتصرف. |

**التوقيع:**

```typescript
(actorId: string, tokenId: string, formKey: string): Promise<boolean>
```

**المرتجعات:**

* `Promise<true>` عند النجاح.
* `Promise<false>` إذا لم يتم العثور على الممثل أو الرمز المميز أو `formKey` المحدد ، أو إذا فشل التحديث.

**التفاصيل:**

تقوم هذه الوظيفة بتحديث تكوين `name` و `texture.src` و `texture.scaleX` و `texture.scaleY` و `disposition` وحلقة `ring` الديناميكية للرمز المميز بناءً على البيانات المحفوظة لـ `formKey` المحدد. إذا كان `formKey` هو `"default"` ، فإنه يستعيد القيم التي تم التقاطها تلقائيًا بواسطة Visage. إذا تم تعيين التصرف المكون للنموذج على `"افتراضي (بدون تغيير)"` (`null` داخليًا) ، فلن يتم تعديل تصرف الرمز المميز بواسطة هذا الاستدعاء عند التبديل إلى هذا الوحدة. إذا كان للوجه المحفوظ اسم فارغ أو مسار صورة فارغ ، فستستخدم هذه الوظيفة تلقائيًا الاسم / الصورة الافتراضية الملتقطة للرمز المميز بدلاً من ذلك.

**مثال:** تبديل رمز مميز معين إلى نموذج "ذئب"

```javascript
visageAPI.setVisage("actor-id-12345", "token-id-67890", "a1b2c3d4e5f6g7h8");
```

#### 2. getForms

يسترد مصفوفة موحدة لجميع الوجوه البديلة المتاحة لممثل معين.

| المعلمة | النوع | الوصف |
| :--- | :--- | :--- |
| `actorId` | `string` | معرف مستند الممثل للاستعلام. |
| `tokenId` | `string` (اختياري) | معرف رمز مميز معين. إذا تم توفيره ، فسيتم استخدام إعداداته الافتراضية كبدائل. إذا تم حذفه ، فسيتم استخدام بيانات الرمز المميز للنموذج الأولي للممثل بدلاً من ذلك. |

**التوقيع:**

```typescript
(actorId: string, tokenId?: string): Array<object> | null
```

**المرتجعات:**

* `Array` من كائنات الوجه ، حيث يكون لكل كائن البنية التالية:
  * `key` (string): المعرف الفريد الداخلي (UUID) للوجه.
  * `name` (string): اسم العرض الذي تم حله. إذا كان للوجه اسم فارغ ، فسيكون هذا هو الاسم الافتراضي (إما من الرمز المميز أو الوحدة الأولي).
  * `path` (string): مسار ملف الصورة الذي تم حله. إذا كان للوجه مسار فارغ ، فسيكون هذا هو مسار الصورة الافتراضي.
  * `scale` (number): عامل المقياس المكون للوجه (على سبيل المثال ، `1.0` ، `1.2` ، `-0.8`).
  * `disposition` (number | null): قيمة تجاوز التصرف المكونة (`1`: صديق ، `0`: محايد ، `-1`: عدائي ، `-2`: سري) أو `null` إذا تم تعيين الوجه على "افتراضي (بدอน تغيير)".
  * `ring` (object | null): كائن تكوين الحلقة الديناميكية. يحتوي على {`enabled` ، `subject` ، `colors` ، `effects`}. إرجاع `null` أو كائن فارغ إذا لم يتم تعيين تجاوزات للحلقة.
* إرجاع `null` إذا لم يتم تحديد نماذج بديلة أو لم يتم العثور على الممثل.

**مثال 1: استخدام معرف ممثل فقط**

```javascript
// سيستخدم هذا الرمز المميز للنموذج الأولي للممثل كبدائل
const forms = visageAPI.getForms("actor-id-12345");

// قد تبدو النماذج كما يلي:
// [ 
//   { 
//     key: "a1...", 
//     name: "ذئب", 
//     path: "path/to/wolf.webp", 
//     scale: 1.2, 
//     disposition: -1,
//     ring: { enabled: false } // تم تعطيل الحلقة بشكل صريح
//   }, 
//   { 
//     key: "b2...", 
//     name: "شكل طيفي", 
//     path: "path/to/ghost.webp", 
//     scale: 1.0, 
//     disposition: -2, // سري
//     ring: { 
//        enabled: true, 
//        colors: { ring: "#00FF00", background: "#000000" }, 
//        effects: 2 // نبض
//     } 
//   } 
// ]
```

#### 3. isFormActive

يتحقق مما إذا كان نموذج المظهر المحدد نشطًا حاليًا على رمز مميز معين.

| المعلمة | النوع | الوصف |
| :--- | :--- | :--- |
| `actorId` | `string` | معرف مستند الممثل المرتبط بالرمز المميز. |
| `tokenId` | `string` | معرف الرمز المميز على **اللوحة** للتحقق منه. |
| `formKey` | `string` | المعرف الفريد (UUID) لنموذج المظهر للتحقق منه (على سبيل المثال ، `"default"` ، `"a1b2c3..."` ، إلخ). |

**التوقيع:**

```typescript
(actorId: string, tokenId: string, formKey: string): boolean
```

**المرتجعات:**

* `true` إذا تطابقت مفتاح **النموذج** المطبق حاليًا للرمز المميز مع المفتاح المقدم ، وإلا `false`.

**مثال:**

```javascript
if (visageAPI.isFormActive("actor-id-12345", "token-id-67890", "a1b2c3d4e5f6g7h8")) {
    console.log("الرمز المميز في شكله الافتراضي.");
}
```

#### 4. resolvePath

وظيفة مساعدة لحل مسار ملف قد يحتوي على حرف بدل Foundry VTT (`*`) إلى مسار صورة ملموس واحد. يستخدم هذا بشكل أساسي لعرض صورة واحدة في معاينات واجهة المستخدم.

| المعلمة | النوع | الوصف |
| :--- | :--- | :--- |
| `path` | `string` | مسار الملف (الذي قد يتضمن حرف بدل). |

**التوقيع:**

```typescript
(path: string): Promise<string>
```

**المرتجعات:**

* `Promise` يتم حلها إلى مسار الملف الملموس. إذا كان المسار لا يحتوي على حرف بدل ، فسيتم إرجاع المسار الأصلي. إذا فشل الحل (على سبيل المثال ، لا توجد ملفات مطابقة) ، فسيتم إرجاع المسar الأصلي كبديل.

**مثال:**

```javascript
const wildcardPath = "path/to/images/*.webp";
const resolved = await visageAPI.resolvePath(wildcardPath);
// قد يكون الحل: "path/to/images/wolf-03.webp"
```

-----

## ملاحظة حول معرفات الرمز المميز مقابل معرفات الممثل

تتطلب طرق Visage API بشكل عام كلاً من `actorId` و `tokenId` لأن تكوينات الوجه المخصصة يتم تخزينها في مستند الممثل ، ولكن يجب تطبيق التغييرات المرئية (الصورة والاسم والمقياس والتصرف) على مستند الرمز المميز المحدد على **اللوحة**. يتم أيضًا تتبع الوحدة النشط حاليًا لكل رمز مميز.

تتطلب طرق Visage API مثل `setVisage` و `isFormActive` كلاً من `actorId` و `tokenId` لأن تكوينات الوجه المخصصة يتم تخزينها في مستند الممثل ، ولكن يجب تطبيق التغييرات المرئية (الصورة والاسم والمقياس والتصرف) على مستند الرمز المميز المحدد على **اللوحة**. يتم أيضًا تتبع الوحدة النشط حاليًا لكل رمز مميز. تعد طريقة `getForms` استثناءً ، حيث يمكن أن تعمل بمعرف `actorId` فقط (بالرجوع إلى بيانات الرمز المميز للنموذج الأولي) ، ولكن توفير `tokenId` سيؤدي إلى نتائج أكثر دقة للقيم الافتراضية.

يمكنك الحصول على كلا المعرفين بشكل موثوق من أي مثيل رمز مميز محدد (`token`) على **اللوحة** باستخدام:

```javascript
const tokenId = token.id;
const actorId = token.actor.id; // يعمل مع كل من الرموز المميزة المرتبطة وغير المرتبطة
```

</div>
