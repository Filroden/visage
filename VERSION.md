# Version History

| Version | Changes |
| :--- | :--- |
| **Version 4.1.0** | **IMPROVEMENTS**<br>- **Individual Transition Delays:** Visual and audio effects can have their own transition delays (negative values to play before the main token appearance change and positive to play after).<br>- **Audio Fade In/Out:** Audio effects can be faded in and/or out.|
| **Version 4.0.2** | **BUG FIXES**<br>- Fixed an edge-case where an automated Visage with a "Status/Active Effect" condition would not trigger immediately if the effect was embedded inside an Item (e.g., class features like Rage, or spells).<br>- Fixed an issue where soft-deleted Visages sitting in the Recycle Bin were still triggering their automations.|
| **Version 4.0.1** | **BUG FIXES**<br>- Fixed issue where an automated Visage with a "Status/Active Effect" condition would only show after a token was moved.|
| **Version 4.0.0** | **NEW FEATURES**<br>- **The Automation Engine:** The module can now automatically apply and remove Visages (both Identities and Overlays) based on real-time game conditions. Players can define rules for their own tokens and GMs can configure "Universal Rules" that listen in the background.<br><br>Triggers include:<br>- **Attributes:** Watch health, shields, or resources (e.g., apply a Visage when HP drops below 50%). It can test numbers, booleans (true/false) or strings.<br>- **Status and Active Effects:** React to core statuses or custom Active Effects (e.g., apply a Visage when "Mage Armour" is cast).<br>- **Events:** Trigger appearances based on Combat states, token elevation, scene illumination and darkness levels, entry/exit from Regions, and whether a token is being targeted.<br><br>- **The Attribute Picker:** A brand new, fully searchable user interface that reads your token's specific system data. Instead of manually typing complex data paths (like `system.attributes.hp.value`), you can simply search "hp" and click to select it.<br><br>**IMPROVEMENTS**<br>- **Live Automation Toggles:** Added a clickable toggle button to Gallery cards to instantly switch a Visage's automation behaviour on or off. A read-only indicator has also been added to the Selector HUD so players can see if an automation is actively monitoring their token.<br>- **Smart Status Effects:** The Status Effect dropdown in the Editor now actively scans the target token and dynamically adds any currently applied custom effects (including those transferred from equipped items). So if you are struggling to find the name of an effect, apply it to your token and it will appear in the dropdown.<br>- **Advanced Trigger Configuration:** Added the ability to manually specify a denominator path for percentage-based attribute triggers. Individual trigger conditions can also be toggled on/off to easily test logic.<br>- **Database Optimisation (Self-Healing)**: The Visage data schema has been overhauled. The Editor now features a "smart scrubber" that automatically strips out untouched default settings, empty arrays, and null values before saving. This  reduces database bloat and memory footprint.<br>- **Diagnostic Exporter**: Added a new Export Diagnostic Log button in the module settings. This allows users to instantly generate a secure, sanitised JSON report of their active modules, Foundry environment, and specific token Visage data to make bug reporting easier.<br><br>**BUG FIXES**<br>- **Sequencer Persistence**: Fixed an issue where hidden/disabled overlays with Sequencer visual effects would accidentally render their animations on a hard refresh (F5) or scene load.<br>- **Wildcard Badges**: Fixed a bug where the Wildcard UI indicator (*) would fail to appear in the Gallery or HUD if the token's dimensions or scale hadn't also been modified.<br>- **Ghost Dirty States**: Fixed an issue where opening certain visages or applying tags would immediately trigger the Editor's "Unsaved Changes" warning due to UI DOM initialisations.|
| **Version 3.5.2** | **BUG FIXES**<br>- Fixed soft deleted Visages being displayed in the Selector HUD.|
| **Version 3.5.1** | **BUG FIXES**<br>- Fixed an issue when in the Editor where if you deselected appearance properties, switched tabs then either saved from the Effects tab or returned to the Appearance tab, it would restore the previous data.|
| **Version 3.5.0** | **NEW FEATURES**<br>- **Public/Private Global Visages**: GMs can mark their Global Visages as either public or private (private is the default). Public global visages will become visible inside players' Selector HUDs and they can apply them to their own tokens.<br><br>**IMPROVEMENTS**<br>- Moved Dynamic Ring configuration into the Editor's Effects tab (to make space for a new tab coming in v4). This now works similar to the Light configuration.<br>- Only persistent effects are restarted when refreshing or returning to a scene with active Visage effects.<br><br>**BUG FIXES**<br>- Fix for error when a token is dropped to the scene that is not owned by the player.<br>- Fixed audio not stopping when switching scenes.|
| **Version 3.4.0** | **NEW FEATURES**<br>- **Import Sample Visages**: A new game setting has been added to allow preset Visages to be imported into the Global Library. Visage packs included with this release include: Light Sources, Token Sizes, Image Scaling, Image Orientation, Dispositions, Rotation Locks. These Overlays make it easy to apply specific changes to any token.<br>- **Image Anchor Customisation**: You can change the X and Y offset for the image within any Visage. Find the new settings in the Editor on the Appearance tab.<br>- **Added PF2E size/scale compatibility**: In the PF2E system, a token's dimensions and image scale are strictly locked to the Actor's statistics to ensure game rules (like reach, flanking, and emanations) work correctly. If the new "Specific System Overrides" game setting is enabled by the GM, then the module handles this lock for you. See the module README or the Wiki for more information.<br><br>**IMPROVEMENTS**<br>- Added a subtle diagonal pinstripe pattern to Overlay Visages in the Local and Global Libraries to give them a different appearance to Identity Visages.|
| **Version 3.3.1** | **IMPROVEMENTS**<br>- Added game setting to disable the welcome chat message.|
| **Version 3.3.0** | **NEW FEATURES**<br>- **Drag and Drop Overlays**: You can now drag and drop Overlays inside the Selector HUD to re-arrange the order they show.<br>- **Show/Hide Overlays**: Instead of deleting and reapplying an Overlay, just toggle the new show/hide icon inside the Selector HUD. Showing an Overlay that includes one-time effects will replay those effects.<br><br>**IMPROVEMENTS**<br>- **Redesigned Selector HUD**: The Selector HUD is now wider and uses a new "Dashboard" tile layout. This creates a dedicated sidebar for status icons (portrait, effects, rotation lock, and wildcard), leaving the preview image larger and completely unobscured.<br>- **Smart Selector HUD Positioning**: The Selector HUD now intelligently detects available screen space and anchors itself to the bottom of the button if you are near the bottom of the screen, preventing it from clipping off-screen.<br><br>**BUG FIXES**<br>- Overlays with no dynamic ring set will no longer hide Overlays below them that do have a dynamic ring set.|
| **Version 3.2.0** | **NEW FEATURES**<br>- **Light source**: Every Visage can now include a configured Foundry light source that applies automatically to the token.<br>- **Actor Portraits**: Visages can now also change the actor's portrait to make a disguise even more convincing.<br>- **Effect transition delay**: Add a delay between changing the Visage's appearance properties (image, scale, disposition, dynamic ring, light source, etc) and any visual and audio effects (and vice versa).<br><br>**IMPROVEMENTS**<br>- **Forge VTT Native Support**: Seamless compatibility with "The Bazaar" and "Forge Assets" when hosted on The Forge .<br>- **Enhanced Compatibility**: Resolved a visual issue where certain module-generated images (such as those from Tokenizer) wouldn't appear in the Visage UI.<br>- **Double-Click Resets**: Range sliders in the editor now support double-clicking to quickly reset values to their standard defaults.<br>- **Welcome Announcement**: Added a small welcome chat message with helpful project links.|
| **Version 3.1.1** | **BUG FIXES**<br>- Fixed CSS class name collisions.|
| **Version 3.1.0** | **NEW FEATURES**<br>- **Play effects once or on loop**: Any visual or audio effect can be toggled between being played once when the Visage is applied, or play on a loop. The toggle is on each effect card. This is a great feature to add sound effects to transitions between Visages.<br>- **Re-order effects**: Effects are now grouped into foreground visual effects, background visual effects and audio effects. Within each group you can drag and drop the effect to change its order (higher on the page means higher position). You can also drag visual effects between the foreground and background groups and it will automatically change its position.|
| **Version 3.0.0** | **MAJOR OVERHAUL: THE UNIFIED UPDATE**<br><br>**ARCHITECTURE**<br>- **Unified Data Model:** Merged "Visages" and "Masks" into a single data structure. Every item now has a `mode` setting: **Identity** (Base replacement) or **Overlay** (Additive layer).<br>- **Universal Scope:** You can now create **Local Overlays** (actor-specific effects) and **Global Identities** (world-wide appearances).<br>- **Auto-Migration:** Existing data from v2.x is automatically migrated to the new format (Legacy Visages become Identities; Legacy Masks become Overlays).<br><br>**NEW FEATURES: EFFECTS ENGINE**<br>- **Sequencer Integration:** Added a new "Effects" tab to the Editor.<br>- **Visual FX:** Attach animated effects (JB2A, etc.) to any item. Controls for Scale, Opacity, Rotation, Z-Order (Above/Below), and Blend Modes.<br>- **Audio FX:** Attach sound effects (PSFX, etc.) that play/loop automatically when the item is applied.<br><br>**UI/UX IMPROVEMENTS**<br>- **Editor Overhaul:** Complete redesign of the Editor window. Features a large "Live Stage" preview with Pan/Zoom controls and a toggleable size Grid. Settings are now organised into three tabs: **Appearance**, **Dynamic Ring**, and **Effects**.<br>- **Sectioned HUD & Gallery:** The UI is now split into "Identities" (Gold) and "Overlays" (Blue) for faster navigation.<br>- **Smart Editor:** Added a Mode Toggle (Identity/Overlay) directly to the Editor header.<br>- **Context Actions:** Added "Apply as Overlay/Identity" action to the library context menu.<br>- **Visual Feedback:** New badges for Active Effects in the Selector HUD with detailed tooltips.|
| **Version 2.4.0** | **NEW FEATURES**<br>- **Duplicate Visage/Mask**: Create a copy of the selected Visage or Mask to make it easier to create variants of existing ones.<br>- **Export Single Masks or Visages**: Export Visages or Masks individually.<br><br>**IMPROVEMENTS**<br>- **Popout menu in Visage Gallery and Mask Library**: Moved less frequently used actions inside the popout menu which can be opened by clicking the "kebab" icon on each Visage/Mask.|
| **Version 2.3.0** | **NEW FEATURES**<br>- **Transfer Mask to Visage Gallery of selected token(s)**: Copy a Mask to the local Visage Gallery of selected token(s).<br>- **Set token opacity**: Set the opacity for each Mask or Visage, so you can create ghostly effects, etc.<br>- **Set rotation lock**: Individually set the rotation lock for each Mask or Visage.<br>- **Export/Import Masks or Visages**: Export all Masks in the global Mask Library, or all Visages on the selected token. Importing will update any data saved in older versions to the current data format, and it will prevent duplication of existing Masks or Visages if they share the same unique ID.<br><br>**IMPROVEMENTS**<br>- **UI Improvements**: Added a chequerboard background to token images to make it easier to see the opacity of the token. Increased the size of the token image inside the Gallery, Library and Editor. Increased the size of the icon in the previews if no token image is selected.|
| **Version 2.2.0** | **NEW FEATURES**<br>- **Promote Visage to the global Mask Library**: Copy a Visage from a token to the global Mask Library so GMs can apply it to other tokens as a Mask.<br><br>**IMPROVEMENTS**<br>- **UI Improvements**: Image orientation is now shown separately for horizontal and vertical axes in the Gallery/Library and in the Editor. If wildcards are used in the image path, this is shown in the left hand side of the live preview in the Editor. If scale is actively set to 100%, this is highlighted as a changed value.<br>- **Data Migration**: - Added a game setting to force a manual data migration. Most users should never need this, but if you ever import an actor that had Visage-related data stored from earlier versions, this will bring the data up to the latest standard.<br><br>**TECHNICAL CHANGES**<br>- Centralised "Context Resolution" function, centralised "Theme & RTL Application", and automated "Is Video?" check.<br><br>**BUG FIXES**<br>- De-coupled image scale and orientation within the data schema so they can be independently set to null (inherit from lower in the stack) or given a value (override). Existing Masks and Visages will be updated to the new data schema in the v2.2 migration.|
| **Version 2.1.0** | **NEW FEATURES**<br>- **Commit to Default**: You can now permanently swap a Token's base appearance with any Visage. When you commit a Visage to default, the module automatically takes a snapshot of the previous default state, saves it as a new Visage, and applies the "Backup" tag for easy filtering. This is perfect for characters undergoing permanent transformations (like aging or equipment upgrades) without losing their original art.<br><br>**IMPROVEMENTS**<br>- **Smart Thumbnails**: The Gallery, Selector HUD and Editor previews now intelligently prioritise the "Subject Texture" if a Dynamic Ring is active. This ensures that the thumbnail you see in the library matches exactly what will appear on the canvas, preventing confusion when a ring overrides the main token image.<br><br>**BUG FIXES**<br>- **Dynamic Ring Logic**: Fixed an issue where disabling a Dynamic Ring in a Visage would fail to turn off the ring if the base token had one enabled. Additionally resolved a "Ghost Subject" issue where new Visages would inherit the base token's Subject Texture, causing the old art to obscure new choices.<br>- **Visibility Toggle Conflict**: Resolved a race condition where toggling a token's "Hidden" state could cause Visage to overwrite the token with stale data. Visage no longer tracks token opacity (alpha), allowing the native Hide/Unhide functionality to work without interference.|
| **Version 2.0.0** | **MAJOR OVERHAUL: INTRODUCING MASKS AND THE STACK SYSTEM**<br>Visage has been re-architected from the ground up to support complex, layered visual changes.<br><br>**NEW FEATURES**<br>- **Non-Destructive Stack System**: You can now layer multiple "Masks" (partial overrides) on top of a "Visage" (identity swap). Removing any layer cleanly restores the state beneath it perfectly.<br>- **Global Mask Library**: Added a new World-level library accessible via Scene Controls. GMs can create generic effects and drag-and-drop them onto any token on the canvas or apply them to any selected tokens.<br>- **Ghost Edit Protection**: Visage now protects your data integrity. If you open the core Token Configuration window while a Visage is active, the module intercepts the window to show you the original token data. This prevents you from accidentally overwriting your character's true face with their temporary disguise.<br>- **Unified Editor**: A completely redesigned editor for creating both Visages and Masks, featuring a "Live Preview" that simulates the token's appearance, including any Dynamic Ring effects, before you save.<br><br>**TECHNICAL CHANGES**<br>- **Data Migration**: Includes a robust migration utility that upgrades all legacy v1.x data to the new unified v2.0 schema automatically.<br>- **Stack Composer**: Implemented a new logic engine (VisageComposer) that calculates token appearance dynamically rather than overwriting database flags.<br>- **Decoupled Architecture**: Separated the Data Layer (VisageData) from the Application Layer (Visage) to improve maintainability.<br><br>**BUG FIXES**<br>- Fixed image names containing wildcards selecting any file from the folder, not just those that match the wildcard name. As a result, you can now use both - and ? wildcards.<br>- Fixed an additional namespace collision.|
| **Version 1.6.2** | - Fixed a bug where filepicker would show "selected" rather than the filepath and name.|
| **Version 1.6.1** | - Sidebar Context Menu: Added a "Visage" option to the right-click menu for Actors in the sidebar. This allows configuration of actors not currently on a scene.<br>- AppV2 Compatibility: Fixed compatibility with ApplicationV2 actor sheets (e.g., DnD5e). Resolved an issue where the Visage option was missing inside the window header controls.|
| **Version 1.6.0** | **ADDED VISAGE CONFIGURATION FROM ACTOR SHEET**: A new Visage button has been added to the Actor Sheet header, allowing you to configure alternate forms and dynamic rings without needing to place a token on the canvas. This is perfect for preparing NPCs or characters before a session, using the Actor's Prototype Token as the baseline for all new configurations.<br><br>- Fixed Default Data Capture: Updated visage-hud.js to correctly capture width and height for the Default Visage to prevent resizing issues.<br>- Fixed Flip Badge Logic: Updated visage-selector.js to show flip badges only when a visage's orientation differs from the default, improving clarity.<br>- Fixed New Visage Defaults: Updated visage-config.js to inherit the current token's Size and Scale when adding a new visage, rather than resetting to 1x1.|
| **Version 1.5.0** | **ADDED TOKEN DIMENSIONS**: Visage now supports changing a token's physical dimensions (width and height in grid spaces). Important: Image Scale is relative to these dimensions. Existing Visages with custom scale values should be checked, as the image scale multiplies with the new physical size leading to some very scary monsters! |
| **Version 1.4.0** | **ADDITIONAL LANGUAGE SUPPORT**: Added support for Arabic, Catalan, Chinese (Simplified and Traditional), Czech, Dutch, English (UK and US), Finnish, French, German, Hebrew, Hungarian, Italian, Japanese, Korean, Persian, Polish, Portuguese (Brazil and Portugal), Romanian, Russian, Spanish (Spain and Latin American), Swedish, Turkish, Ukrainian and Welsh using AI-generated translations for most so I apologise now for any mistakes. I am happy to update any localisation file with any corrections.<br><br>**ADDED RIGHT-TO-LEFT LANGUAGE SUPPORT**: Introduce bidirectional text support and interface mirroring. When a user selects a Right-to-Left language (like Arabic or Hebrew), the entire layout — including navigation bars, icons, and text alignment—will flip to align with the natural reading flow of that language, ensuring a localised experience.<br><br>**ADDED ANIMATED TOKEN SUPPORT**: Full support for animated tokens. You can now apply any valid Foundry image filetype to the token and it will display correctly in the Selector HUD, including animated token art using webm format. Note that animated tokens are not compatible with Dynamic Token Rings. If you apply a dynamic ring to a token using animated art, it will render the art as a static image.|
| **Version 1.3.0** | **ADDED DYNAMIC TOKEN RINGS**: Full support for Dynamic Token Rings. You can now save specific ring configurations (Enabled/Disabled, Colors, Effects, Scale) for each visage. The Selector HUD shows any dynamic ring on the Visage, including animated effects for pulse, gradient, background wave and invisibility. |
| **Version 1.2.1** | - Improved accessibility to respect all font size changes by user.<br>- Improved UI theme to a warmer background.<br>- Added additional tooltips.<br>- Added notes to the Visage configuration window if no Visages are configured.|
| **Version 1.2.0** | - Moved module to ApplicationV2 in preparation for implementing a global Visage directory.<br>- Added data normalisation helper.<br>- Added internationalisation.<br>- Updated migration script as it missed unlinked tokens.|
| **Version 1.1.1** | - Fix bug that prevented multiple Visages being created at the same time. |
| **Version 1.1.0** | - Visages can now be saved with blank Name or Image Path fields to create "partial" visages, inheriting the token's default name/image as needed.<br>- Upgraded the getForms API to accept an optional tokenId to intelligently resolve these partial visages using either token-specific defaults or (if no ID is provided) the actor's prototype token defaults. |
| **Version 1.0.8** | - Internal: Rename misleading name-key and UUID-key variables. |
| **Version 1.0.7** | - Correct manifest link (for real this time). |
| **Version 1.0.6** | - Correct manifest link. |
| **Version 1.0.5** | - Remove box-shadow on Visage Selector HUD setting icon. |
| **Version 1.0.1** | - Remove red bottom border on Visage Selector title.<br>- Allow duplicate visage names. |
| **Version 1.0.0** | **FULL RELEASE**<br>- Internal: Refactored internal data storage from name-keyed to UUID-keyed actor flags for improved data integrity.<br>- Added one time migration for beta-testers.<br>- Additional documentation improvements before public release. |
| **Version 0.5.0** | - Add feature to configure and apply token disposition (Friendly, Neutral, Hostile, Secret) with each visage, enabling disguise and illusion mechanics.<br>- Update styling for configuration window and selector HUD chip.<br>- Update documentation.<br>- Small styling changes to Visage Configuration window. |
| **Version 0.4.0** | - Internal: Significant re-write.<br>- Move the token configuration from the default token window where there was a rendering issue, to its own window, opened by clicking a setting cog in the Visage Selector HUD.<br>- Add styling to the "Save Changes" button if there are changes to be saved.<br>- Match the new config window style to the Selector HUD style.<br>- Sort Visage forms in the Selector HUD in alphabetical order with the default always first.<br>- Add shuffle icon on any visage form that uses a wildcard within its filepath to show user they can select it again for a different random pick. |
| **Version 0.3.4** | - Fix flip option for token images. |
| **Version 0.3.3** | - Fix bug when restoring scale to default (again).<br>- Fix how wildcard paths are resolved to prevent the mystery man appearing. |
| **Version 0.3.2** | - Fix bug when restoring scale to default. |
| **Version 0.3.1** | - Fix label in configuration tab. |
| **Version 0.3.0** | - Add a token image scaling feature, including option to flip the image. |
| **Version 0.2.4** | - Add module setting to remove visage data from tokens.<br>- Add star icon to default token tile in selector HUD.<br>- Add usage instructions to the README.md. |
| **Version 0.2.3** | - Internal: Under the covers code improvement.<br>- Improvements made to visage token configuration. |
| **Version 0.2.1** | - Fix issue with reading data from tokens that were not linked to actors. |
| **Version 0.2.0** | **INITIAL BETA RELEASE** |
